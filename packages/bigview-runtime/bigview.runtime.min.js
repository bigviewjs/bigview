var _bigviewDebug=function(e,t){var i=(new Date).getTime(),r=!1;return"undefined"!=typeof process?r=process.env._bigview:"undefined"!=typeof window&&(r=window.localStorage&&localStorage._bigview),function(e,t){r&&(e=e||"bigview",t=t||"",console.log("Module: "+e+"  "+t+"%c [+"+((new Date).getTime()-i)+"ms];","color: blue"))}}(),_errorTemplate='<div class="bigview-error-template" style="position:relative;height:100%; text-align:center;padding-top:10px;">';_errorTemplate+='<img style="display:inline-block;height:50px;" src="https://gw.alicdn.com/tfs/TB1iNyybgmTBuNjy1XbXXaMrVXa-100-100.png" />',_errorTemplate+="<p>Some Errors ~</p>",_errorTemplate+='<p><a href="javascript:;" class="js-bigview-retry" style="display:inline-block; padding:4px 12px;line-height:32px; text-decoration:none; color: blue;">Retry </a>';var BigEvent=function(){};BigEvent.prototype.on=function(e,t){this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)},BigEvent.prototype.off=function(e,t){this._listeners=this._listeners||{},this._listeners[e].splice(this._listeners[e].indexOf(t),1)},BigEvent.prototype.trigger=function(e){this._listeners=this._listeners||{};for(var t=arguments[1]?arguments[1]:null,i=this._listeners[e]||[],r=0;r<i.length;r++){var n=i[r];t?n.call(this,t):n.call(this)}},BigEvent.extend=function(e){for(var t=["on","off","trigger"],i=0;i<t.length;i++){var r=t[i];"function"==typeof e?e.prototype[r]=BigEvent.prototype[r]:e[r]=BigEvent.prototype[r]}};var Bigview=function(){var e=this;this.endPagelets=[],this.on("end",function(){this.endPagelets.forEach(function(t){e.handlePayload(t)})}),this.log=function(e,t){_bigviewDebug(e,t)},this.view=function(t){e.trigger("pageletArrive",t),e.log(t.domid,"pageletArrive"),t.domid&&e.trigger(t.domid,t)},this.ready=function(t){this.log("ready"),e.trigger("ready",t)},this.end=function(e){this.log("end"),this.trigger("end",e)},this.error=function(t){this.trigger("error",t);var i=this.replaceHtml(t.domid,this.errorTemplate).querySelector(".js-bigview-retry");i&&i.addEventListener("click",function(){e._request(t)})},this.beforePageletArrive=function(t){e.trigger("beforePageletArrive",t)},this.on("pageletArrive",function(e){if("end"===e.lifecycle)return this.endPagelets.push(e);this.handlePayload(e)}),this.handlePayload=function(t){if(t.error&&e.error(t),t.css){(Array.isArray(t.css)?t.css:[t.css]).forEach(function(t){e.insertCss(t)})}if(t.domid&&t.html&&!t.error&&e.replaceHtml(t.domid,t.html,t.attr),t.js){(Array.isArray(t.js)?t.js:[t.js]).forEach(function(t){e.insertScript(t)})}},this.replaceHtml=function(e,t,i){var r="string"==typeof e?document.getElementById(e):e;if(r){var n=r.cloneNode(!1);if(i&&"object"==typeof i){for(var o in i)console.log(o),n.setAttribute(o,i[o]);n.setAttribute("modshow",1)}n.innerHTML=t.replace(/~~~~~~~/g,"<").replace(/=========/g,">"),r.parentNode.replaceChild(n,r);for(var s=n.getElementsByTagName("script"),a=(s=Array.prototype.slice.call(s)).length,l=0;l<a;l++){var c=s[l],d=document.createElement("SCRIPT");c.src?(d.src=c.src,c.parentNode.replaceChild(d,c)):c.innerText.trim()&&(d.text=c.innerText,c.parentNode.replaceChild(d,c))}return n}},this.insertCss=function(e){var t=document.createElement("link");t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},this.insertScript=function(e){var t=document.createElement("SCRIPT");t.src=e,document.body.appendChild(t)},this._request=function(t){var i=location.href;location.search?i+="&_pagelet_id="+t.domid:i+="?_pagelet_id="+t.domid;var r=new XMLHttpRequest;r.onload=function(t){var i=r.response,n={};try{n=JSON.parse(i)}catch(e){401===r.status&&_bigviewDebug("access_denied",r.statusText)}n.error=!1,e.view(n)},r.onerror=function(i){e.error(t),console.error(i)},r.open("GET",i,!0),r.setRequestHeader("bigview_error_time",Date.now()),r.send()}};BigEvent.extend(Bigview);var _bigview=new Bigview;_bigview.errorTemplate=_errorTemplate,"function"==typeof define&&define.amd?define("bigview",[],function(){return _bigview}):"object"==typeof exports?module.exports=_bigview:window.bigview=_bigview;